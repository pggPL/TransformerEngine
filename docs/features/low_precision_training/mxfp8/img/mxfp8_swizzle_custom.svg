<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500">
  <style>
    .title { font: bold 20px sans-serif; fill: #333; }
    .subtitle { font: bold 16px sans-serif; fill: #444; }
    .label { font: 14px sans-serif; fill: #555; }
    .small { font: 12px sans-serif; fill: #666; }
    .box { fill: #f9f9f9; stroke: #333; stroke-width: 1; }
    .highlight { fill: #e1f5fe; stroke: #0288d1; stroke-width: 2; }
    .block-swizzled { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 2; }
    .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    .cell { stroke: #999; stroke-width: 0.5; }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <text x="400" y="30" text-anchor="middle" class="title">MXFP8 Swizzling: Block Layout &amp; Interleaving</text>

  <!-- SECTION 1: Logical Input -->
  <text x="150" y="70" text-anchor="middle" class="subtitle">1. Logical Scaling Factors</text>
  <text x="150" y="90" text-anchor="middle" class="small">(M rows x K cols)</text>

  <!-- Grid representing scaling factor tensor -->
  <g transform="translate(50, 110)">
    <!-- Draw a large grid outline -->
    <rect x="0" y="0" width="200" height="300" class="box" />
    
    <!-- Highlight the 128x4 block -->
    <rect x="0" y="0" width="40" height="150" class="highlight" />
    
    <!-- Label the dimensions of the block -->
    <path d="M -10 0 L -10 150" stroke="#333" marker-start="url(#tick)" marker-end="url(#tick)"/>
    <text x="-15" y="75" text-anchor="end" class="label" transform="rotate(-90, -15, 75)">128 rows</text>
    
    <path d="M 0 -10 L 40 -10" stroke="#333" />
    <text x="20" y="-15" text-anchor="middle" class="label">4 cols</text>
    
    <text x="100" y="150" text-anchor="middle" class="small" dy="20">Standard Row-Major</text>
    <text x="100" y="150" text-anchor="middle" class="small" dy="35">(Strided access in memory)</text>
  </g>

  <!-- Arrow -->
  <g transform="translate(280, 200)">
    <path d="M 0 0 L 60 0" class="arrow" />
    <text x="30" y="-10" text-anchor="middle" class="label">Swizzle</text>
  </g>

  <!-- SECTION 2: Swizzled Output -->
  <text x="550" y="70" text-anchor="middle" class="subtitle">2. Swizzled Memory Layout</text>
  
  <!-- Contiguous Block -->
  <g transform="translate(400, 110)">
    <rect x="0" y="0" width="300" height="150" class="block-swizzled" />
    
    <text x="150" y="30" text-anchor="middle" class="label" font-weight="bold">128x4 Block (Contiguous)</text>
    
    <!-- Internal Structure (Interleaving) -->
    <g transform="translate(50, 50)">
      <!-- Illustrate interleaving with small cells -->
      <rect x="0" y="0" width="200" height="60" fill="#fff" stroke="#999" />
      
      <!-- Cells -->
      <rect x="0" y="0" width="20" height="20" fill="#ffccbc" class="cell"/> <text x="10" y="15" font-size="10" text-anchor="middle">0</text>
      <rect x="20" y="0" width="20" height="20" fill="#c8e6c9" class="cell"/> <text x="30" y="15" font-size="10" text-anchor="middle">128</text>
      <rect x="40" y="0" width="20" height="20" fill="#bbdefb" class="cell"/> <text x="50" y="15" font-size="10" text-anchor="middle">256</text>
      <rect x="60" y="0" width="20" height="20" fill="#fff9c4" class="cell"/> <text x="70" y="15" font-size="10" text-anchor="middle">384</text>
      
      <rect x="0" y="20" width="20" height="20" fill="#ffccbc" class="cell"/> <text x="10" y="35" font-size="10" text-anchor="middle">1</text>
      <rect x="20" y="20" width="20" height="20" fill="#c8e6c9" class="cell"/> <text x="30" y="35" font-size="10" text-anchor="middle">129</text>
      <rect x="40" y="20" width="20" height="20" fill="#bbdefb" class="cell"/> <text x="50" y="35" font-size="10" text-anchor="middle">257</text>
      <rect x="60" y="20" width="20" height="20" fill="#fff9c4" class="cell"/> <text x="70" y="35" font-size="10" text-anchor="middle">385</text>

      <text x="100" y="35" class="small" fill="#666">... Interleaved Data ...</text>
    </g>
    
    <text x="150" y="130" text-anchor="middle" class="small">Optimized for Tensor Core access</text>
  </g>

  <!-- SECTION 3: Description Box -->
  <g transform="translate(50, 430)">
    <rect x="0" y="0" width="700" height="60" fill="#f0f0f0" rx="5" />
    <text x="20" y="25" class="label" font-weight="bold">What Swizzle Does:</text>
    <text x="20" y="45" class="small">1. Collects scaling factors into <tspan font-weight="bold">128x4 blocks</tspan> (covering 128x128 data elements).</text>
    <text x="350" y="25" class="small">2. Stores each block <tspan font-weight="bold">contiguously</tspan> in memory (Block-Linear Layout).</text>
    <text x="350" y="45" class="small">3. <tspan font-weight="bold">Interleaves</tspan> elements within the block to minimize bank conflicts.</text>
  </g>
</svg>
