<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 770 240">
  <defs>
    <style>
      @import url("../../../_static/css/diagram-colors.css");
      
      /* Diagram-specific styles */
      .gather-box { fill: #c8e6c9; stroke: #388e3c; stroke-width: 2; }
      .convert-box { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      
      /* Arrow override */
      .arrow { marker-end: url(#arrowhead); }
    </style>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#616161" />
    </marker>
  </defs>
  
  <!-- FORWARD PASS -->
  <g id="forward-pass">
    <!-- Label -->
    <text x="20" y="35" class="section-title" style="text-anchor: start;">Forward:</text>
    
    <!-- Step 1: Quantize -->
    <rect x="100" y="20" width="80" height="45" rx="6" class="quantize"/>
    <text x="140" y="45" class="text">Quantize</text>
    
    <!-- Arrow 1 -->
    <path d="M 180 42 L 215 42" class="arrow"/>
    
    <!-- Step 2: FP8 Blockwise Rowwise -->
    <rect x="215" y="20" width="110" height="45" rx="6" class="fp8"/>
    <text x="270" y="36" class="text">FP8 Blockwise</text>
    <text x="270" y="48" class="small-text" text-anchor="middle">Rowwise</text>
    <text x="270" y="60" class="small-text" text-anchor="middle">COMPACT</text>
    
    <!-- Arrow 2 -->
    <path d="M 325 42 L 360 42" class="arrow"/>
    
    <!-- Step 3: All-Gather -->
    <rect x="360" y="20" width="80" height="45" rx="6" class="gather-box"/>
    <text x="400" y="40" class="text">All-Gather</text>
    <text x="400" y="55" class="small-text" text-anchor="middle">rowwise</text>
    
    <!-- Arrow 3 -->
    <path d="M 440 42 L 475 42" class="arrow"/>
    
    <!-- Step 4: Convert -->
    <rect x="475" y="20" width="80" height="45" rx="6" class="convert-box"/>
    <text x="515" y="36" class="text">Convert to</text>
    <text x="515" y="48" class="small-text" text-anchor="middle">GEMM_</text>
    <text x="515" y="60" class="small-text" text-anchor="middle">READY</text>
    
    <!-- Arrow 4 -->
    <path d="M 555 42 L 590 42" class="arrow"/>
    
    <!-- Step 5: Computation -->
    <rect x="590" y="20" width="80" height="45" rx="6" class="gemm"/>
    <text x="630" y="40" class="text">Forward</text>
    <text x="630" y="55" class="small-text" text-anchor="middle">GEMM</text>
  </g>
  
  <!-- BACKWARD PASS -->
  <g id="backward-pass">
    <!-- Label -->
    <text x="20" y="145" class="section-title" style="text-anchor: start;">Backward:</text>
    
    <!-- Curved arrow from quantize to columnwise -->
    <path d="M 140 65 Q 140 100 215 130" class="arrow"/>
    
    <!-- Step 2: FP8 Blockwise Columnwise -->
    <rect x="215" y="130" width="110" height="45" rx="6" class="fp8"/>
    <text x="270" y="146" class="text">FP8 Blockwise</text>
    <text x="270" y="158" class="small-text" text-anchor="middle">Columnwise</text>
    <text x="270" y="170" class="small-text" text-anchor="middle">COMPACT</text>
    
    <!-- Arrow 2 -->
    <path d="M 325 152 L 360 152" class="arrow"/>
    
    <!-- Step 3: All-Gather -->
    <rect x="360" y="130" width="80" height="45" rx="6" class="gather-box"/>
    <text x="400" y="150" class="text">All-Gather</text>
    <text x="400" y="165" class="small-text" text-anchor="middle">columnwise</text>
    
    <!-- Arrow 3 -->
    <path d="M 440 152 L 475 152" class="arrow"/>
    
    <!-- Step 4: Convert -->
    <rect x="475" y="130" width="80" height="45" rx="6" class="convert-box"/>
    <text x="515" y="146" class="text">Convert to</text>
    <text x="515" y="158" class="small-text" text-anchor="middle">GEMM_</text>
    <text x="515" y="170" class="small-text" text-anchor="middle">READY</text>
    
    <!-- Arrow 4 -->
    <path d="M 555 152 L 590 152" class="arrow"/>
    
    <!-- Step 5: Computation -->
    <rect x="590" y="130" width="80" height="45" rx="6" class="gemm"/>
    <text x="630" y="150" class="text">Backward</text>
    <text x="630" y="165" class="small-text" text-anchor="middle">GEMM</text>
  </g>
</svg>

