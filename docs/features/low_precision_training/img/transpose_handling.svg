<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 650">
  <defs>
    <style>
      /* Common styles loaded from diagram-colors.css: .hp, .fp8, .amax, .quantize, .text, .small-text, .title, .section-title, .arrow */
      .arrow {
        stroke: #616161;
        stroke-width: 2;
        fill: none;
        marker-end: url(#arrowhead);
      }
      .hardware {
        fill: #f3e5f5;
        stroke: #8e24aa;
        stroke-width: 2.5;
      }
      .label-box {
        fill: #f5f5f5;
        stroke: #9e9e9e;
        stroke-width: 1.5;
      }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3, 0 6" fill="#616161" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="450" y="30" class="title">Transpose Handling Strategies</text>
  
  <!-- Blackwell Section -->
  <text x="450" y="65" class="section-title" style="fill: #8e24aa;">Blackwell and Later: Hardware Transpose Support</text>
  
  <rect x="50" y="85" width="800" height="120" class="label-box" rx="8"/>
  
  <!-- Forward Pass -->
  <rect x="80" y="105" width="120" height="60" class="hp" rx="6"/>
  <text x="140" y="132" class="text">High Precision</text>
  <text x="140" y="150" class="text">Tensor</text>
  
  <path d="M 200 135 L 250 135" class="arrow"/>
  
  <rect x="250" y="105" width="120" height="60" class="quantize" rx="6"/>
  <text x="310" y="132" class="text" style="font-weight: 600;">Cast to</text>
  <text x="310" y="150" class="text" style="font-weight: 600;">FP8</text>
  
  <path d="M 370 135 L 420 135" class="arrow"/>
  
  <rect x="420" y="105" width="120" height="60" class="fp8" rx="6"/>
  <text x="480" y="132" class="text">FP8 Tensor</text>
  <text x="480" y="150" class="small-text">(stored)</text>
  
  <path d="M 540 135 L 590 135" class="arrow"/>
  
  <!-- Hardware Transpose -->
  <rect x="590" y="105" width="140" height="60" class="hardware" rx="6"/>
  <text x="660" y="127" class="text" style="font-weight: 600;">Tensor Core</text>
  <text x="660" y="145" class="text">HW Transpose</text>
  <text x="660" y="160" class="small-text">(no extra cost)</text>
  
  <!-- Divider -->
  <line x1="50" y1="240" x2="850" y2="240" stroke="#bdbdbd" stroke-width="2"/>
  
  <!-- Hopper/Ada Section -->
  <text x="450" y="275" class="section-title" style="fill: #0277bd;">Hopper and Ada: Software Transpose</text>
  
  <!-- Option 1 -->
  <text x="450" y="305" class="label" style="font-weight: 600; fill: #2e7d32;">Option 1: Compute Both During Cast (optimal in most cases)</text>
  
  <rect x="50" y="320" width="800" height="140" class="label-box" rx="8"/>
  
  <rect x="80" y="340" width="120" height="60" class="hp" rx="6"/>
  <text x="140" y="367" class="text">High Precision</text>
  <text x="140" y="385" class="text">Tensor</text>
  
  <path d="M 200 370 L 250 370" class="arrow"/>
  
  <rect x="250" y="340" width="140" height="80" class="quantize" rx="6"/>
  <text x="320" y="367" class="text" style="font-weight: 600;">Cast to FP8</text>
  <text x="320" y="385" class="small-text">+ compute</text>
  <text x="320" y="403" class="small-text">transpose</text>
  
  <path d="M 390 360 L 440 350" class="arrow"/>
  <path d="M 390 380 L 440 390" class="arrow"/>
  
  <rect x="440" y="330" width="110" height="40" class="fp8" rx="6"/>
  <text x="495" y="355" class="text">FP8 Tensor</text>
  
  <rect x="440" y="380" width="110" height="40" class="fp8" rx="6"/>
  <text x="495" y="400" class="text">FP8 Tensor^T</text>
  <text x="495" y="415" class="small-text">(saved)</text>
  
  <path d="M 550 400 L 600 400" class="arrow"/>
  
  <rect x="600" y="370" width="140" height="60" class="gemm" rx="6"/>
  <text x="670" y="397" class="text" style="font-weight: 600;">Backward Pass</text>
  <text x="670" y="415" class="text">(use Tensor^T)</text>
  
  <!-- Option 2 -->
  <text x="450" y="490" class="label" style="font-weight: 600; fill: #d84315;">Option 2: Transpose in Backward (used in some distributed cases)</text>
  
  <rect x="50" y="505" width="800" height="130" class="label-box" rx="8"/>
  
  <rect x="80" y="525" width="120" height="60" class="hp" rx="6"/>
  <text x="140" y="552" class="text">High Precision</text>
  <text x="140" y="570" class="text">Tensor</text>
  
  <path d="M 200 555 L 250 555" class="arrow"/>
  
  <rect x="250" y="525" width="120" height="60" class="quantize" rx="6"/>
  <text x="310" y="552" class="text" style="font-weight: 600;">Cast to</text>
  <text x="310" y="570" class="text" style="font-weight: 600;">FP8</text>
  
  <path d="M 370 555 L 420 555" class="arrow"/>
  
  <rect x="420" y="525" width="110" height="60" class="fp8" rx="6"/>
  <text x="475" y="552" class="text">FP8 Tensor</text>
  <text x="475" y="570" class="small-text">(saved)</text>
  
  <path d="M 530 555 L 580 555" class="arrow"/>
  
  <rect x="580" y="525" width="120" height="60" class="quantize" rx="6"/>
  <text x="640" y="547" class="text" style="font-weight: 600;">Transpose</text>
  <text x="640" y="565" class="text">(in backward)</text>
  
  <path d="M 700 555 L 750 555" class="arrow"/>
  
  <rect x="750" y="525" width="80" height="60" class="fp8" rx="6"/>
  <text x="790" y="552" class="text">Tensor^T</text>
  
</svg>



