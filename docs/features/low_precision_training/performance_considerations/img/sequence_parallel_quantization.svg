<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 620" width="850" height="620">
  <defs>
    <style>
      @import url("diagram-colors.css");
      
      /* Arrows */
      .arrow { stroke: #616161; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      
      /* Phase labels */
      .phase-forward { fill: #1565c0; font-weight: 600; }
      .phase-backward { fill: #c62828; font-weight: 600; }
      
      /* All-gather operation */
      .allgather {
        fill: #e1f5fe;
        stroke: #039be5;
        stroke-width: 2;
      }
    </style>
    <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#616161" />
    </marker>
  </defs>
  
  <!-- Section 1: Input Tensor -->
  <text x="425" y="35" class="section-title" style="fill: #212121; font-weight: 600;">Input Tensor quantized all-gather</text>
  
  <!-- Forward phase label -->
  <text x="20" y="93" class="text phase-forward" style="text-anchor: start;">FWD:</text>
  
  <!-- High Precision Input -->
  <rect x="90" y="65" width="130" height="55" class="hp" rx="6"/>
  <text x="155" y="88" class="text">High Precision</text>
  <text x="155" y="105" class="text">Tensor</text>
  
  <!-- Arrow -->
  <path d="M 220 92 L 250 92" class="arrow"/>
  
  <!-- Quantize -->
  <rect x="250" y="65" width="100" height="55" class="quantize" rx="6"/>
  <text x="300" y="97" class="text">Quantize</text>
  
  <!-- Arrow -->
  <path d="M 350 92 L 380 92" class="arrow"/>
  
  <!-- Rowwise Quantized Tensor -->
  <rect x="380" y="65" width="130" height="55" class="fp8" rx="6"/>
  <text x="445" y="88" class="text">Rowwise</text>
  <text x="445" y="105" class="text">Quantized</text>
  
  <!-- Arrow -->
  <path d="M 510 92 L 540 92" class="arrow"/>
  
  <!-- All-Gather -->
  <rect x="540" y="65" width="110" height="55" class="allgather" rx="6"/>
  <text x="595" y="97" class="text">All-Gather</text>
  
  <!-- Arrow -->
  <path d="M 650 92 L 680 92" class="arrow"/>
  
  <!-- Continue indicator -->
  <text x="705" y="97" class="text">...</text>
  
  <!-- Backward phase label -->
  <text x="20" y="193" class="text phase-backward" style="text-anchor: start;">BWD:</text>
  
  <!-- Arrow from Quantize to Columnwise (showing separate quantization) -->
  <path d="M 300 120 L 300 145 L 380 192" class="arrow"/>
  
  <!-- Columnwise Quantized Tensor -->
  <rect x="380" y="165" width="130" height="55" class="fp8" rx="6"/>
  <text x="445" y="188" class="text">Columnwise</text>
  <text x="445" y="205" class="text">Quantized</text>
  
  <!-- Arrow -->
  <path d="M 510 192 L 540 192" class="arrow"/>
  
  <!-- All-Gather -->
  <rect x="540" y="165" width="110" height="55" class="allgather" rx="6"/>
  <text x="595" y="197" class="text">All-Gather</text>
  
  <!-- Arrow -->
  <path d="M 650 192 L 680 192" class="arrow"/>
  
  <!-- Continue indicator -->
  <text x="705" y="197" class="text">...</text>
  
  <!-- Divider Line -->
  <line x1="30" y1="270" x2="820" y2="270" stroke="#bdbdbd" stroke-width="3"/>
  
  <!-- Section 2: Gradient Tensor -->
  <text x="425" y="305" class="section-title" style="fill: #212121; font-weight: 600;">Gradient Tensor quantized all-gather</text>
  
  <!-- Backward phase label -->
  <text x="20" y="378" class="text phase-backward" style="text-anchor: start;">BWD:</text>
  
  <!-- High Precision Gradient -->
  <rect x="90" y="350" width="130" height="55" class="hp" rx="6"/>
  <text x="155" y="373" class="text">High Precision</text>
  <text x="155" y="390" class="text">Tensor</text>
  
  <!-- Arrow -->
  <path d="M 220 377 L 250 377" class="arrow"/>
  
  <!-- Quantize -->
  <rect x="250" y="350" width="100" height="55" class="quantize" rx="6"/>
  <text x="300" y="382" class="text">Quantize</text>
  
  <!-- Arrow to Columnwise -->
  <path d="M 350 362 L 380 342" class="arrow"/>
  
  <!-- Columnwise Quantized Tensor -->
  <rect x="380" y="320" width="130" height="45" class="fp8" rx="6"/>
  <text x="445" y="347" class="text">Col. Quantized</text>
  
  <!-- Arrow to Rowwise -->
  <path d="M 350 392 L 380 412" class="arrow"/>
  
  <!-- Rowwise Quantized Tensor -->
  <rect x="380" y="390" width="130" height="45" class="fp8" rx="6"/>
  <text x="445" y="417" class="text">Row. Quantized</text>
  
  <!-- Arrow from Columnwise to All-Gather -->
  <path d="M 510 342 L 540 377" class="arrow"/>
  
  <!-- Arrow from Rowwise to All-Gather -->
  <path d="M 510 412 L 540 377" class="arrow"/>
  
  <!-- All-Gather (single, shared) -->
  <rect x="540" y="355" width="110" height="45" class="allgather" rx="6"/>
  <text x="595" y="382" class="text">All-Gather</text>
  
  <!-- Arrow -->
  <path d="M 650 377 L 680 377" class="arrow"/>
  
  <!-- Continue indicator -->
  <text x="705" y="382" class="text">...</text>
  
  <!-- Legend -->
  <g transform="translate(100, 475)">
    <rect x="0" y="0" width="80" height="40" rx="5" class="hp"/>
    <text x="95" y="23" class="text" style="text-anchor: start;">High Precision (FP32/BF16/FP16)</text>
    
    <rect x="380" y="0" width="80" height="40" rx="5" class="fp8"/>
    <text x="475" y="23" class="text" style="text-anchor: start;">Lower Precision (FP8, etc.)</text>
    
    <rect x="0" y="55" width="80" height="40" rx="5" class="quantize"/>
    <text x="95" y="78" class="text" style="text-anchor: start;">Quantization</text>
    
    <rect x="380" y="55" width="80" height="40" rx="5" class="allgather"/>
    <text x="475" y="78" class="text" style="text-anchor: start;">All-Gather</text>
  </g>
  
</svg>

